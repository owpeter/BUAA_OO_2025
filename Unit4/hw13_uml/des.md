题目描述

在一所小型图书馆中，用户借阅图书需要遵守一定的规章制度。我们需要你模拟一个小型的图书管理系统，完成图书馆所支持的相关业务。

图书馆里的所有图书按照 “类别号-序列号” 的形式编制ISBN号（同学们可以理解为 ISBN 国际标准书号的简化形式，即一本书的ISBN号是唯一的，它的所有副本的ISBN号都是相同的）。图书分 A 、B 、C 三类，由类别号标识，每种类别可能包含多个图书。每个ISBN号的图书可能具有多个副本（具有不同副本号）。图书馆中具体的某一本书籍由唯一的“类别号-序列号-副本号”形式编制书号。对于不同类别的书，有不同的借阅数量限制。

图书馆的运行分为两个时段：白天开馆，夜晚闭馆。开馆后，图书管理系统需要处理用户的各种请求，依据图书馆的运行规则决定是否批准用户的请求；同时，开馆时和闭馆时，图书馆内部依据需要整理各部门的图书，以满足接下来可能处理的各种请求。

在本次作业中，开馆时图书管理系统需要处理的请求包括：借书、还书、查询、预约和预约取书。

一、流程描述

重要概念说明：

本次作业中，我们规定：
书籍仅可以存在于如下四个位置：书架、预约处、借还处和用户。
图书馆系统提供自助查询机查询书籍历史移动轨迹。
图书馆开馆后接收用户请求，输出处理结果；开馆和闭馆整理图书时，输出图书的转运路径。

借阅流程

若一位用户来到图书馆借阅某书籍，按照如下规则来进行处理：

若欲借阅的书籍无余本在架，借阅失败；
若欲借阅的书籍为 A 类书籍，借阅失败（ A 类图书无法借阅）；
若欲借阅的书籍为 B 类或 C 类书籍，若符合借阅数量限制则借阅成功，该用户从此刻起持有该书；否则借阅失败，书籍仍留在在书架。

还书流程

若一位用户来到图书馆归还某书籍，则该用户会前往借还处，在本次作业中还书立即成功，从此刻起，借还处持有该书，用户不再持有该书。

预约流程

若一位用户需要预约某书籍，则该用户需要前往预约处登记。

该用户必须满足下述要求才可以预约成功：
预约的书不是 A 类书（规定 A 类书无法预约）。
若已经持有一本 B 类书，则无法再预约任何 B 类书。
若已经持有某ISBN号的 C 类书，则不能预约该ISBN号的 C 类书。
若此前已经预定过书籍且还未取书，则预约失败。
预约成功后，图书馆可在此后的整理流程中选择将书送至预约处，送至预约处的图书需要指定是为了满足哪个用户的预约请求而送达的，具体输出格式见后。
图书送至预约处后，若在开馆后整理中送达，则从当日起为该用户保留 5 天；若在闭馆后整理中送达，从次日起为该用户保留 5 天。在此期间，该书不能在整理流程中移动。第五天闭馆时，该书不再视作为该用户保留，视为预约失效。从次日起，预约该书的用户将无法取走该书，图书馆可对该书进行整理。例如1月1日开馆后送达，则1月5日闭馆后，该书不再为用户保留；1月1日闭馆后送达，则1月6日闭馆后，该书不再为用户保留。

取书流程

用户只能去预约处取书。

若预约处存在一本为该用户预留的图书，且取书后该用户持有的书仍然满足借阅数量限制，则该用户取书成功，即刻起由用户持有该书，且该用户对于该书的一个成功预约视作完成，不再生效。否则取书失败，书籍不发生移动。

取书时，对于用户要取的这本书，如果预约处存在多本副本，只能取走整理操作时指定给该用户预留的书籍副本。

查询流程

若用户需要查询图书馆内某本书的历史移动轨迹信息，可前往自助查询机处查询：

输入“类别号-序列号-副本号”，查询某副本的历史移动轨迹。
可移动的状态包括：书架、借阅处、预约处、用户。
整理流程

每次开馆和每次闭馆后，系统都有一次机会整理各处的图书，此时系统可以在不违反规则的情况下任意移动图书馆内的可在整理流程中移动的图书（整理的目的是为了满足请求，只要不违反限制，也可以不移动图书）。

为了保证图书馆的借阅成功率，对整理图书进行如下限制：

在开馆对应的整理后（即在 OPEN 指令对应的整理后），借还处不应该有书，预约处不应该有逾期的书。
不可以为没有预定特定书籍的用户预留该书籍（即为该用户将该书籍送至预约处）。
同学们可以自由考虑使用何种策略为预约预留书籍（没有特别限制，但建议以提高借阅成功率为目的），但是不允许无条件拒绝为预约预留书籍。
二、规则描述

图书借阅数量限制

A 类书：不可借阅，不可预约。
B 类书：一人同一时刻仅能持有一个 B 类书的副本。
C 类书：对于每一个ISBN号，一人同一时刻仅能持有一个具有该ISBN号的书籍副本。
图书移动限制

任何可以引起图书位置变化的操作，该书数量的变化符合实际（一次移动仅可以改变单一副本的位置，本次作业中任何时候图书总数不变）。

具体的，此次作业中，可以引起图书位置变化的操作如下：

用户借阅书架图书成功：书架 -> 用户
用户取书：预约处 -> 用户
用户还书：用户 -> 借还处
整理时的图书转运：借还处，书架，预约处这三个位置中从一个位置到另一个位置
